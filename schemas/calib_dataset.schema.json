{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.local/calib-planar-dataset.schema.json",
  "title": "Planar Detection Dataset",
  "description": "Minimal planar correspondences consumed by the calibration pipeline.",
  "type": "object",
  "additionalProperties": false,
  "required": ["sensor_id", "images"],
  "properties": {
    "image_directory": {
      "type": "string",
      "description": "Location of image assets associated with this dataset."
    },
    "feature_type": {
      "type": "string",
      "description": "Detector family identifier (e.g. planar, aprilgrid)."
    },
    "algo_version": {
      "type": "string",
      "description": "Detector or feature extraction version string."
    },
    "params_hash": {
      "type": "string",
      "pattern": "^[0-9a-fA-F]{8,64}$",
      "description": "Hash over detector parameters for reproducibility."
    },
    "sensor_id": {
      "type": "string",
      "minLength": 1,
      "description": "Identifier of the camera or sensor that produced the detections."
    },
    "tags": {
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "uniqueItems": true,
      "description": "Optional labels describing the dataset (e.g. synthetic, recorded)."
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "description": "Detector-specific metadata."
    },
    "images": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/image" },
      "description": "Per-image planar detections."
    }
  },
  "$defs": {
    "image": {
      "type": "object",
      "additionalProperties": false,
      "required": ["file", "points"],
      "properties": {
        "file": {
          "type": "string",
          "minLength": 1,
          "description": "Image filename or identifier."
        },
        "points": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/point" },
          "description": "Planar correspondences detected in the image."
        }
      }
    },
    "point": {
      "type": "object",
      "additionalProperties": false,
      "required": ["x", "y", "local_x", "local_y"],
      "properties": {
        "id": {
          "type": "integer",
          "description": "Optional target identifier."
        },
        "x": {
          "type": "number",
          "description": "Image coordinate along X (pixels)."
        },
        "y": {
          "type": "number",
          "description": "Image coordinate along Y (pixels)."
        },
        "local_x": {
          "type": "number",
          "description": "Target coordinate along X (metres or arbitrary units)."
        },
        "local_y": {
          "type": "number",
          "description": "Target coordinate along Y."
        },
        "local_z": {
          "type": "number",
          "description": "Target coordinate along Z (defaults to 0 for planar boards)."
        }
      }
    }
  }
}
